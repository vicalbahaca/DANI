<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Feliz aniversario Dani</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Dancing+Script:wght@600&display=swap');

    :root {
      --paper: #faf6f3;
      --ink: #161616;
      --muted: #6b6b6b;
      --accent: #d64a6a;
    }

    * {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: radial-gradient(1200px 700px at 20% 10%, #fff5f0 0%, var(--paper) 55%, #f2ece6 100%);
      font-family: 'Lato', sans-serif;
      color: var(--ink);
    }

    #canvas-container {
      position: fixed;
      inset: 0;
      z-index: 1;
    }

    #ui-layer {
      position: fixed;
      inset: 0;
      z-index: 2;
      pointer-events: none;
    }

    .logo {
      position: fixed;
      top: 36px;
      left: 48px;
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      letter-spacing: 2px;
      font-size: 0.95rem;
      text-transform: uppercase;
      z-index: 10;
      color: #3a2f2f;
    }

    .slide-content {
      position: absolute;
      top: 18%;
      left: 7%;
      width: 36%;
      max-width: 520px;
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      background: rgba(255, 255, 255, 0.45);
      backdrop-filter: blur(4px);
      padding: 24px 28px 28px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
    }

    h1 {
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      font-style: italic;
      font-size: 3.6rem;
      margin: 0 0 1.2rem 0;
      line-height: 1.05;
      color: #1a1313;
    }

    .description {
      font-size: 1rem;
      font-weight: 300;
      line-height: 1.75;
      color: #343434;
    }

    .mb-6 {
      margin-bottom: 1.2rem;
    }

    .text-pink-600 {
      color: var(--accent);
    }

    .font-bold {
      font-weight: 700;
    }

    .text-3xl {
      font-size: 2rem;
    }

    .mt-8 {
      margin-top: 1.8rem;
    }

    .handwritten-font {
      font-family: 'Dancing Script', cursive;
      letter-spacing: 0.5px;
    }

    .cta {
      display: inline-block;
      margin-top: 1.2rem;
      padding: 0.85rem 1.6rem;
      border-radius: 999px;
      background: #1f1a1a;
      color: #fff;
      text-decoration: none;
      letter-spacing: 0.5px;
      font-weight: 600;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.18);
    }

    .cta:hover {
      transform: translateY(-2px);
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.22);
    }

    .collapse-btn {
      position: absolute;
      top: 14px;
      right: 14px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      background: rgba(255, 255, 255, 0.8);
      color: #2b2b2b;
      padding: 6px 10px;
      font-size: 0.75rem;
      letter-spacing: 0.5px;
      border-radius: 999px;
      cursor: pointer;
    }

    .slide-content.collapsed {
      opacity: 0;
      pointer-events: none;
      transform: translateY(20px);
    }

    .float-bubble {
      position: fixed;
      left: 28px;
      top: 50%;
      transform: translateY(-50%);
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: #1f1a1a;
      color: #fff;
      border: none;
      font-weight: 600;
      letter-spacing: 0.5px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 20;
      cursor: pointer;
    }

    .float-bubble.show {
      opacity: 1;
      pointer-events: auto;
    }

    .scroll-hint {
      position: fixed;
      bottom: 36px;
      left: 48px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: #b2a8a3;
    }

    @media (max-width: 1100px) {
      .slide-content {
        width: 48%;
      }
      h1 {
        font-size: 3rem;
      }
    }

    @media (max-width: 800px) {
      .slide-content {
        width: 80%;
        left: 10%;
        top: 10%;
        max-height: 75vh;
        overflow: auto;
      }
      h1 {
        font-size: 2.4rem;
      }
      .logo, .scroll-hint {
        left: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="logo">Para Dani</div>

  <div id="canvas-container"></div>

  <div id="ui-layer">
    <div class="slide-content" id="slide-0">
      <button class="collapse-btn" id="collapse-btn" type="button" aria-expanded="true">
        Ocultar carta
      </button>
      <div class="letter-content">
      <h1>Feliz san valentin Dani</h1>
      <div class="description">
        <p class="mb-6">
          He hecho esta tontería para ti. Ya sabes que estoy a tope con cosas de trabajo y con lo fácil que es hacer una cosa de estas no podía no hacerla.
        </p>
        <p class="mb-6">
          Te hace mucha ilusión san valentín, así que a mí <span class="text-pink-600 font-bold">200% más</span>. Lo que te hace feliz, a mí me hace más feliz aún.
        </p>
        <p class="mb-6">
          Te mereces todo lo bonito que te pueda pasar y yo estoy para que pase. Gracias por aguantarme, gracias por quererme y por darme tanto amor.
        </p>
        <p class="mb-6">
          Jamás pensé que podía sentirme tan tan querido por alguien, espero que dure toda la vida, no me imagino otra cosa.
        </p>
        <p class="text-3xl font-bold text-pink-600 handwritten-font mt-8">
          Te amo te amo te amo te amo
        </p>
        <a class="cta" href="regalito.html">Abrir regalito</a>
      </div>
      </div>
    </div>
  </div>

  <div class="scroll-hint">Desliza para explorar</div>
  <button class="float-bubble" id="float-bubble" type="button" aria-expanded="false" aria-controls="slide-0">
    Carta
  </button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <script>
    const images = [
      'Files/IMG_8311.JPG',
      'Files/IMG_4804.JPG',
      'Files/IMG_4272.JPG',
      'Files/IMG_0268.JPG',
      'Files/FullSizeRender.JPG'
    ];

    const isMobile = window.innerWidth <= 768;

    const CONFIG = {
      slideCount: images.length,
      spacingX: isMobile ? 30 : 45,
      pWidth: isMobile ? 10 : 14,
      pHeight: isMobile ? 13 : 18,
      camZ: isMobile ? 26 : 30,
      wallAngleY: -0.25,
      snapDelay: 200,
      lerpSpeed: 0.06
    };

    const totalGalleryWidth = CONFIG.slideCount * CONFIG.spacingX;

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xfaf6f3);
    scene.fog = new THREE.Fog(0xfaf6f3, 10, 110);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 0, CONFIG.camZ);

    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.55);
    dirLight.position.set(10, 20, 10);
    scene.add(dirLight);

    const galleryGroup = new THREE.Group();
    scene.add(galleryGroup);

    const textureLoader = new THREE.TextureLoader();
    const planeGeo = new THREE.PlaneGeometry(CONFIG.pWidth, CONFIG.pHeight);

    function applyCoverCrop(texture, frameAspect) {
      if (!texture || !texture.image) return;
      const imageAspect = texture.image.width / texture.image.height;

      if (imageAspect > frameAspect) {
        const scale = frameAspect / imageAspect;
        texture.repeat.set(scale, 1);
        texture.offset.set((1 - scale) / 2, 0);
      } else {
        const scale = imageAspect / frameAspect;
        texture.repeat.set(1, scale);
        texture.offset.set(0, (1 - scale) / 2);
      }

      texture.wrapS = THREE.ClampToEdgeWrapping;
      texture.wrapT = THREE.ClampToEdgeWrapping;
      texture.needsUpdate = true;
    }

    const paintingGroups = [];

    for (let i = 0; i < CONFIG.slideCount; i++) {
      const group = new THREE.Group();
      group.position.set(i * CONFIG.spacingX, 0, 0);

      const mat = new THREE.MeshBasicMaterial({
        map: textureLoader.load(images[i], (tex) => {
          applyCoverCrop(tex, CONFIG.pWidth / CONFIG.pHeight);
        })
      });
      const mesh = new THREE.Mesh(planeGeo, mat);

      const edges = new THREE.EdgesGeometry(planeGeo);
      const outline = new THREE.LineSegments(edges, new THREE.LineBasicMaterial({ color: 0x2a2a2a }));

      const shadowGeo = new THREE.PlaneGeometry(CONFIG.pWidth, CONFIG.pHeight);
      const shadowMat = new THREE.MeshBasicMaterial({ color: 0x000000, transparent: true, opacity: 0.16 });
      const shadow = new THREE.Mesh(shadowGeo, shadowMat);
      shadow.position.set(0.8, -0.8, -0.5);

      const lineZ = -1;
      const lineLen = CONFIG.spacingX;
      const lineGeo = new THREE.BufferGeometry().setFromPoints([
        new THREE.Vector3(-lineLen / 2, 14, lineZ), new THREE.Vector3(lineLen / 2, 14, lineZ),
        new THREE.Vector3(-lineLen / 2, -14, lineZ), new THREE.Vector3(lineLen / 2, -14, lineZ)
      ]);
      const lines = new THREE.LineSegments(lineGeo, new THREE.LineBasicMaterial({ color: 0xdddddd }));

      group.add(shadow);
      group.add(mesh);
      group.add(outline);
      group.add(lines);

      galleryGroup.add(group);
      paintingGroups.push(group);
    }

    galleryGroup.rotation.y = CONFIG.wallAngleY;
    galleryGroup.position.x = 8;

    let currentScroll = 0;
    let targetScroll = 0;
    let snapTimer = null;
    let mouse = { x: 0, y: 0 };

    function snapToNearest() {
      const index = Math.round(targetScroll / CONFIG.spacingX);
      targetScroll = index * CONFIG.spacingX;
    }

    window.addEventListener('wheel', (e) => {
      targetScroll += e.deltaY * 0.1;
      if (snapTimer) clearTimeout(snapTimer);
      snapTimer = setTimeout(snapToNearest, CONFIG.snapDelay);
    });

    let touchStart = 0;
    window.addEventListener('touchstart', e => {
      touchStart = e.touches[0].clientX;
      if (snapTimer) clearTimeout(snapTimer);
    });

    window.addEventListener('touchmove', e => {
      const diff = touchStart - e.touches[0].clientX;
      targetScroll += diff * 0.6;
      touchStart = e.touches[0].clientX;
      if (snapTimer) clearTimeout(snapTimer);
    });

    window.addEventListener('touchend', () => {
      snapToNearest();
    });

    window.addEventListener('mousemove', (e) => {
      mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
      mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
    });

    const slideCard = document.getElementById('slide-0');
    const collapseBtn = document.getElementById('collapse-btn');
    const floatBubble = document.getElementById('float-bubble');

    function setCollapsed(collapsed) {
      slideCard.classList.toggle('collapsed', collapsed);
      floatBubble.classList.toggle('show', collapsed);
      collapseBtn.setAttribute('aria-expanded', String(!collapsed));
      floatBubble.setAttribute('aria-expanded', String(collapsed));
    }

    collapseBtn.addEventListener('click', () => setCollapsed(true));
    floatBubble.addEventListener('click', () => setCollapsed(false));

    function animate() {
      requestAnimationFrame(animate);
      currentScroll += (targetScroll - currentScroll) * CONFIG.lerpSpeed;
      const xMove = currentScroll * Math.cos(CONFIG.wallAngleY);
      const zMove = currentScroll * Math.sin(CONFIG.wallAngleY);
      camera.position.x = xMove;
      camera.position.z = CONFIG.camZ - zMove;

      paintingGroups.forEach((group, i) => {
        const originalX = i * CONFIG.spacingX;
        const distFromCam = currentScroll - originalX;
        const shift = Math.round(distFromCam / totalGalleryWidth) * totalGalleryWidth;
        group.position.x = originalX + shift;
      });

      camera.rotation.x = mouse.y * 0.05;
      camera.rotation.y = -mouse.x * 0.05;

      renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
  </script>
</body>
</html>
